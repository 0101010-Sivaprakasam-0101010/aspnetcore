<Project>

  <Import Project="Helix.Common.props" />

  <ItemDefinitionGroup>
    <HelixContent>
      <CopyToBuildDirectory>Never</CopyToBuildDirectory>
      <CopyToPublishDirectory>Always</CopyToPublishDirectory>
    </HelixContent>
  </ItemDefinitionGroup>

  <PropertyGroup>
    <CreateHelixPayload>true</CreateHelixPayload>
    <HelixTimeout>00:30:00</HelixTimeout>
    <RunQuarantinedTests>false</RunQuarantinedTests>
    <IsWindowsHelixQueue>false</IsWindowsHelixQueue>
    <IsWindowsHelixQueue Condition="$(HelixTargetQueue.Contains('Windows')) or $(HelixTargetQueue.Contains('windows'))">true</IsWindowsHelixQueue>
    <HelixTestName>$(MSBuildProjectName)--$(TargetFramework)</HelixTestName>
    <HelixUseArchive>false</HelixUseArchive>
    <LoggingTestingDisableFileLogging Condition="'$(IsHelixJob)' == 'true'">false</LoggingTestingDisableFileLogging>
    <NodeVersion>10.15.3</NodeVersion>
    <AppRuntimeVersion>5.0.0-ci</AppRuntimeVersion>
  </PropertyGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'">
    <HelixProjectPlatform Include="Windows" />
  </ItemGroup>

  <ItemGroup Condition="'$(TargetFrameworkIdentifier)' != '.NETFramework'">
    <HelixProjectPlatform Include="@(HelixAvailablePlatform)" />
  </ItemGroup>

  <ItemGroup>
    <HelixContent Include="$(RepoRoot)eng\helix\content\**\*" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnMssql)' == 'true' AND '$(IsWindowsHelixQueue)' == 'true'">
    <HelixPreCommand Include="call RunPowershell.cmd mssql\InstallSqlServerLocalDB.ps1 || exit /b 1" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnNode)' == 'true' AND '$(IsWindowsHelixQueue)' == 'false'">
    <HelixPreCommand Include="./installnode.sh $(NodeVersion) $(TargetArchitecture)" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnNode)' == 'true' AND '$(IsWindowsHelixQueue)' == 'true'">
    <HelixPreCommand Include="call RunPowershell.cmd InstallNode.ps1 $(NodeVersion) %25HELIX_CORRELATION_PAYLOAD%25\node\bin || exit /b 1" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnAppRuntime)' == 'true' AND '$(IsHelixJob)' == 'true' AND '$(IsWindowsHelixQueue)' == 'true'">
    <HelixContent Include="$(RepoRoot)artifacts\packages\Release\Shipping\Microsoft.AspNetCore.App.Runtime.win-x86.$(AppRuntimeVersion).nupkg" />
    <HelixPreCommand Include="call RunPowershell.cmd InstallAppRuntime.ps1 Microsoft.AspNetCore.App.Runtime.win-x86.$(AppRuntimeVersion).nupkg Microsoft.AspNetCore.App\$(AppRuntimeVersion) /b 1" />
  </ItemGroup>

  <ItemGroup Condition="'$(TestDependsOnAppRuntime)' == 'true' AND '$(IsHelixJob)' == 'true' AND '$(IsWindowsHelixQueue)' == 'false'">
    <HelixContent Include="$(RepoRoot)artifacts\packages\Release\Shipping\Microsoft.AspNetCore.App.Runtime.win-x86.$(AppRuntimeVersion).nupkg" />
    <HelixPreCommand Include="./installappruntime.sh Microsoft.AspNetCore.App.Runtime.win-x86.$(AppRuntimeVersion).nupkg Microsoft.AspNetCore.App/$(AppRuntimeVersion)" />
  </ItemGroup>
  
</Project>
